---
phase: 03-content-quality
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - Content/Data/quests.json
  - Content/Data/interactions.json
  - TWL.Tests/HiddenCoveTests.cs
  - TWL.Tests/Quests/QuestValidationTests.cs
autonomous: true

must_haves:
  truths:
    - "Hidden Cove main chain (1401-1404) progresses without dead-ends and claims rewards correctly"
    - "Hidden Cove sidequest (2401) respects prerequisites and interaction-based item acquisition"
    - "Crafting and item-consumption interactions required for cove progression remain reliable"
  artifacts:
    - path: "Content/Data/quests.json"
      provides: "Canonical hidden-cove quest definitions and prerequisites"
      contains: "\"QuestId\": 1401"
    - path: "Content/Data/interactions.json"
      provides: "Gathering/crafting/blasting interaction behavior for cove progression"
      contains: "HeavyRocks"
    - path: "TWL.Tests/HiddenCoveTests.cs"
      provides: "Progression and sidequest regression tests for hidden cove"
      contains: "HiddenCove_Chain_Progression"
  key_links:
    - from: "Content/Data/quests.json"
      to: "Content/Data/interactions.json"
      via: "quest objective targets rely on interaction IDs and item effects"
      pattern: "RepairedRadioTower|NorthEastCliff|HeavyRocks|SulfurVent|BurntTree|AlchemyTable|HiddenDock|FishingSpot"
    - from: "TWL.Tests/HiddenCoveTests.cs"
      to: "Content/Data/interactions.json"
      via: "tests verify gather/craft/consume behavior through ProcessInteraction"
      pattern: "ProcessInteraction\\("
---

<objective>
Stabilize Hidden Cove chain content and interaction contracts to prevent progression and crafting regressions.

Purpose: This plan completes the second high-risk branch in QUAL-01 and ensures cove-specific content remains executable end-to-end.
Output: Updated hidden-cove quest and interaction data with stronger regression checks for 1401-1404 and 2401.
</objective>

<execution_context>
@~/.codex/get-shit-done/workflows/execute-plan.md
@~/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-content-quality/03-RESEARCH.md

@docs/quests/ROADMAP.md
@docs/quests/design/2024-05-22-hidden-cove.md
@Content/Data/quests.json
@Content/Data/interactions.json
@TWL.Tests/HiddenCoveTests.cs
@TWL.Tests/Quests/QuestValidationTests.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Normalize Hidden Cove quest chain definitions and gating</name>
  <files>
    Content/Data/quests.json
  </files>
  <action>
    1. Audit and correct quest definitions for `1401-1404` and `2401`:
       - prerequisite chain
       - objective ordering and required counts
       - rewards and repeatability behavior

    2. Keep alignment with the hidden-cove design spec while preserving current executable test contracts.

    3. Confirm objective target names exactly match interaction identifiers used by cove tests.
  </action>
  <verify>
    Run `dotnet test TWL.Tests/TWL.Tests.csproj --filter "FullyQualifiedName~HiddenCoveTests"`.
  </verify>
  <done>
    Hidden Cove quest data is coherent and progression-safe for the full arc and sidequest path.
  </done>
</task>

<task type="auto">
  <name>Task 2: Stabilize cove interaction behaviors for gather/craft/blast flow</name>
  <files>
    Content/Data/interactions.json
  </files>
  <action>
    1. Validate interaction entries used by cove progression:
       - `RepairedRadioTower`
       - `NorthEastCliff`
       - `HeavyRocks`
       - `SulfurVent`
       - `BurntTree`
       - `AlchemyTable`
       - `HiddenDock`
       - `FishingSpot`

    2. Ensure item grants and consumes are consistent with the expected flow:
       sulfur + charcoal -> black powder -> heavy rocks cleared.

    3. Ensure sidequest interaction prerequisites (fishing rod and prior quest gates) remain explicit.
  </action>
  <verify>
    Run `dotnet test TWL.Tests/TWL.Tests.csproj --filter "FullyQualifiedName~HiddenCoveTests"`.
  </verify>
  <done>
    All cove progression interactions consistently support objective completion and sidequest collection.
  </done>
</task>

<task type="auto">
  <name>Task 3: Expand cove regression assertions for negative-path stability</name>
  <files>
    TWL.Tests/HiddenCoveTests.cs
    TWL.Tests/Quests/QuestValidationTests.cs
  </files>
  <action>
    1. Extend cove tests with targeted negative-path checks:
       - prerequisites not met -> start denied
       - missing required materials -> craft/progression does not advance
       - wrong interaction target does not falsely complete objectives

    2. Keep test data deterministic and focused on cove arc behavior.

    3. Add or refine quest validation coverage for cove quest structural integrity where it prevents silent data drift.
  </action>
  <verify>
    Run `dotnet test TWL.Tests/TWL.Tests.csproj --filter "FullyQualifiedName~HiddenCoveTests|FullyQualifiedName~QuestValidationTests"`.
  </verify>
  <done>
    Cove tests cover both happy path and critical failure modes that previously escaped early detection.
  </done>
</task>

</tasks>

<verification>
- [ ] `dotnet test TWL.Tests/TWL.Tests.csproj --filter "FullyQualifiedName~HiddenCoveTests"` passes
- [ ] Hidden Cove objectives map to valid interactions and item behavior
- [ ] Sidequest 2401 prerequisites and interaction flow are explicitly validated
- [ ] Quest validation tests stay green after cove content updates
</verification>

<success_criteria>
- QUAL-01 hidden-cove scope is stable and covered by deterministic regression tests
- Gather/craft/consume chain behavior is preserved and verifiable
- Hidden Cove progression cannot regress silently without test failures
</success_criteria>

<output>
After completion, create `.planning/phases/03-content-quality/03-02-SUMMARY.md`
</output>
