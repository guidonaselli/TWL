---
phase: 03-content-quality
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - TWL.Client/Resources/Strings.resx
  - TWL.Client/Resources/Strings.en.resx
  - config/localization-audit-allowlist.json
  - TWL.Tests/Localization/LocalizationValidationTests.cs
  - TWL.Tests/Localization/LocalizationArcCoverageTests.cs
autonomous: true

must_haves:
  truths:
    - "Localization resources include all keys required by Hidden Ruins, Ruins Expansion, and Hidden Cove quest content"
    - "Localization validation reports zero ERROR findings after phase-specific content updates"
    - "Arc-specific localization regressions fail immediately when keys are missing in base or English resources"
  artifacts:
    - path: "TWL.Client/Resources/Strings.resx"
      provides: "Base language keys for quest names/descriptions/objective text"
      contains: "QUEST_"
    - path: "TWL.Client/Resources/Strings.en.resx"
      provides: "English language parity for all required arc keys"
      contains: "QUEST_"
    - path: "TWL.Tests/Localization/LocalizationArcCoverageTests.cs"
      provides: "Deterministic arc-scoped key existence regression checks"
      contains: "LocalizationArcCoverageTests"
  key_links:
    - from: "Content/Data/quests.json"
      to: "TWL.Client/Resources/Strings.resx"
      via: "TitleKey/DescriptionKey references must resolve in required languages"
      pattern: "TitleKey|DescriptionKey|Objective.*Key"
    - from: "TWL.Tests/Localization/LocalizationArcCoverageTests.cs"
      to: "TWL.Client/Resources/Strings.en.resx"
      via: "test asserts base/en parity for phase-3 arc key set"
      pattern: "Strings\\.en\\.resx"
---

<objective>
Close localization gaps for Phase 3 quest arcs and codify arc-specific key coverage as a regression guardrail.

Purpose: This plan completes QUAL-01 by ensuring content updates remain localizable and validation-safe across required languages.
Output: Updated resource bundles, tightened localization audit configuration, and dedicated arc-scoped localization coverage tests.
</objective>

<execution_context>
@~/.codex/get-shit-done/workflows/execute-plan.md
@~/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-content-quality/03-RESEARCH.md
@.planning/phases/03-content-quality/03-01-PLAN.md
@.planning/phases/03-content-quality/03-02-PLAN.md

@docs/core/localization/AUDIT_RULES.md
@config/localization-audit-allowlist.json
@TWL.Client/Resources/Strings.resx
@TWL.Client/Resources/Strings.en.resx
@TWL.Tests/Localization/Audit/LocalizationAuditor.cs
@TWL.Tests/Localization/LocalizationValidationTests.cs
@Content/Data/quests.json
@Content/Data/interactions.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Reconcile Phase 3 arc keys with base and English resources</name>
  <files>
    TWL.Client/Resources/Strings.resx
    TWL.Client/Resources/Strings.en.resx
  </files>
  <action>
    1. Extract all localization keys referenced by Hidden Ruins, Ruins Expansion, and Hidden Cove content after plans `03-01` and `03-02`.

    2. Add any missing keys to both required resource files (`base` and `en`) with consistent semantic naming (prefixes per audit rules).

    3. Ensure any `Loc.TF`-formatted strings maintain placeholder parity across languages.
  </action>
  <verify>
    Run `dotnet test TWL.Tests/TWL.Tests.csproj --filter "FullyQualifiedName~LocalizationValidationTests"` and confirm no ERROR findings.
  </verify>
  <done>
    All Phase 3 arc localization keys resolve in both required language bundles without format mismatches.
  </done>
</task>

<task type="auto">
  <name>Task 2: Tighten localization audit configuration for deterministic enforcement</name>
  <files>
    config/localization-audit-allowlist.json
    TWL.Tests/Localization/LocalizationValidationTests.cs
  </files>
  <action>
    1. Review and minimize allowlist entries related to this phase so missing/invalid arc keys are not hidden by broad suppressions.

    2. Keep auditor behavior fail-closed for `ERROR` severity and ensure test output remains actionable.

    3. Update validation test messaging only as needed to keep diagnostics clear for content authors.
  </action>
  <verify>
    Run `dotnet test TWL.Tests/TWL.Tests.csproj --filter "FullyQualifiedName~LocalizationValidationTests"`.
  </verify>
  <done>
    Localization audit configuration is strict enough to catch real arc issues while retaining justified suppressions only.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add arc-scoped localization coverage regression tests</name>
  <files>
    TWL.Tests/Localization/LocalizationArcCoverageTests.cs
  </files>
  <action>
    1. Add a dedicated localization regression test suite that asserts required key presence for:
       - Hidden Ruins / Ruins Expansion IDs (`1301-1307`, related sidequest keys)
       - Hidden Cove IDs (`1401-1404`, `2401`)

    2. Validate key existence in both `Strings.resx` and `Strings.en.resx`, failing with actionable missing-key output.

    3. Keep this suite focused on Phase 3 arcs so failures map directly to content changes in this phase.
  </action>
  <verify>
    Run `dotnet test TWL.Tests/TWL.Tests.csproj --filter "FullyQualifiedName~LocalizationArcCoverageTests|FullyQualifiedName~LocalizationValidationTests"`.
  </verify>
  <done>
    Arc-specific localization key regressions are automatically detected before merge.
  </done>
</task>

</tasks>

<verification>
- [ ] `dotnet test TWL.Tests/TWL.Tests.csproj --filter "FullyQualifiedName~LocalizationValidationTests"` passes with zero ERROR findings
- [ ] Arc-scoped localization coverage tests pass for base and English bundles
- [ ] Added or updated keys follow naming conventions from `AUDIT_RULES.md`
- [ ] Allowlist changes are minimal and justified
</verification>

<success_criteria>
- QUAL-01 localization scope is complete for Phase 3 quest arcs
- Missing-key and format mismatch regressions fail automatically
- Localization quality is enforced by both generic and arc-targeted tests
</success_criteria>

<output>
After completion, create `.planning/phases/03-content-quality/03-03-SUMMARY.md`
</output>
