# Daily Architecture Report - 2026-01-29

## Focus: Correct World Loop (P0)

### Summary
Addressed the "World loop correcto" requirement by refactoring `WorldScheduler` from a loose `Task.Delay` implementation to a deterministic **Fixed Time Step** loop (20 TPS).

### Changes
1.  **Contract Update (`IWorldScheduler`)**:
    *   Added `long CurrentTick { get; }` for monotonic time tracking.
    *   Added `event Action<long> OnTick` for synchronized execution.

2.  **Implementation (`WorldScheduler`)**:
    *   Refactored to use `Stopwatch` + Accumulator pattern.
    *   Fixed tick rate at 50ms.
    *   Implemented "Spiral of Death" prevention (max 10 ticks per frame).
    *   Maintained backward compatibility for `Schedule/ScheduleRepeating`.

3.  **Observability**:
    *   Integrated with `ServerMetrics` to track `SlowTicks` and `WorldLoopTick` duration.
    *   Updated `ServerWorker` to use `OnTick` for metrics logging.

### Impact
*   **Determinism**: The server now has a reliable heartbeat.
*   **Separation of Concerns**: Combat logic can now subscribe to `OnTick` to implement turn-based logic distinct from real-time execution, satisfying `COMB-001` (Turn system determinista) prerequisites.
*   **Reliability**: Reduced timer drift risk.

### Next Steps
*   Implement `CombatTurnScheduler` subscribing to `OnTick`.
*   Migrate `StatusEngine.Tick` to use `CurrentTick` (or keep it manual per turn).
