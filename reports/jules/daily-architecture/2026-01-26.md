# Daily Architecture Report - 2026-01-26

## Objective
Implement stable contracts (`IWorldScheduler`, `IStatusEngine`) and a correct World Loop mechanism to separate world ticks from combat turns, and decouple status effect logic from entities.

## Changes

### 1. World Scheduler (Game Loop)
- **Interface**: `IWorldScheduler` (Shared)
- **Implementation**: `WorldScheduler` (Server) using `Task` based loop (20hz tick).
- **Integration**: Wired into `ServerWorker` and `GameServer` startup.
- **Benefit**: Allows scheduling delayed and repeating tasks (e.g. respawns, regen) independent of client requests.

### 2. Status Engine (Logic Decoupling)
- **Interface**: `IStatusEngine` (Shared)
- **Implementation**: `StatusEngine` (Server)
- **Refactor**: Extracted complex status logic (Stacking, Conflict/Priority, Expiration) from `ServerCharacter` into `StatusEngine`.
- **Integration**: Injected into `CombatManager`. `ServerCharacter` now delegates status application to the engine.
- **Benefit**: `ServerCharacter` is now a cleaner entity. Status logic is testable in isolation. `CombatManager` usage is explicit.

### 3. Dependency Injection
- Updated `Program.cs` to register new services (`IWorldScheduler`, `IStatusEngine`, `IRandomService`, `ICombatResolver`).
- Updated `ServerWorker` to manage scheduler lifecycle.

## Verification
- **New Tests**:
  - `WorldSchedulerTests`: Verified one-off and repeating schedules.
  - `StatusEngineTests`: Verified conflict resolution, stacking policies, and expiration.
- **Regression**:
  - Updated existing tests (`CombatManagerTests`, `SkillStackingTests`, etc.) to match new constructor and method signatures.
  - All tests passed.

## Next Steps
- Utilize `IWorldScheduler` for Respawn logic (Map/Mob spawning).
- Expand `IStatusEngine` to support global/environmental effects if needed.
