# Daily Architecture Report - 2026-02-02

## Summary
Focused on hardening the RNG architecture (CORE-005) to ensure determinism, testability, and auditability across both Server and Shared domains.

## Changes
- **Shared Domain**: Created `DefaultRandomService` in `TWL.Shared` to provide a thread-safe (via `Random.Shared`) default implementation of `IRandomService`.
- **Battle Logic**: Refactored `BattleInstance` to inject `IRandomService`. Replaced all ad-hoc `new Random()` instantiations with the injected service, eliminating non-deterministic behavior and enabling full replayability/testing.
- **Auditability**: Added semantic context strings (e.g., "SkillEffect_BuffStats", "StepEncounterCheck") to RNG calls in `BattleInstance` and `SpawnManager`. This ensures all gameplay-impacting random events are traceable in logs.
- **Tests**: Updated `SpawnManagerTests` and `SeedableRandomServiceTests` to verify correct context usage and logging levels.

## Impact
- **Determinism**: Combat resolution is now fully deterministic if seeded, critical for future features like replay systems or authoritative client prediction.
- **Testability**: `BattleInstance` logic can now be unit-tested with fixed seeds or mocks, removing flakiness.
- **Observability**: RNG outcomes are now audited with context, allowing easier debugging of "bad luck" claims or probability bugs.

## Next Steps
- Continue with **CORE-001** (Message Protocol Versioning) or **CORE-004** (Correlation ID).
