# Daily Security Report - 2026-02-01

## Hardening Bind/Unbind & Item Transfers

### 1. Bind-On-Equip Enforcement
*   **Vulnerability:** `BindOnEquip` items were not being bound to the character upon usage/equipping, leaving them tradable indefinitely. The `UseItemRequest` opcode was defined but unhandled.
*   **Fix:** Implemented `ServerCharacter.UseItem` and `ClientSession.HandleUseItemAsync`.
    *   Using an equipment item with `BindPolicy.BindOnEquip` now sets `BoundToId` to the character's ID.
    *   Generates an audit log: `[SECURITY] ... [Event:ItemBound] ItemId:X Policy:BindOnEquip BoundTo:Y`.
*   **Verification:** Added `BindOnEquipHardeningTests`.
    *   `Should_Bind_Item_On_Use`: Confirms item transitions from Unbound to Bound.
    *   `Should_Reject_Trade_Of_Used_BindOnEquip_Item`: Confirms `TradeManager` rejects transfer of the now-bound item.

### 2. Consumable Logic
*   **Hardening:** Implemented server-side consumption logic in `ServerCharacter.UseItem` to ensure consumables are decremented and removed from inventory upon use, preventing infinite usage exploits.
*   **Verification:** `Should_Consume_Consumable_On_Use` test confirms quantity reduction and removal.

### 3. Codebase Integrity Fixes
*   **ClientSession:** Restored missing `SendLoginError` helper method which was causing compilation errors in the authentication flow.
*   **Test Infrastructure:** Fixed broken tests in `WorldTriggerServiceTests` (missing dependencies, incorrect `QuestDefinition` initialization) to ensure a clean CI/CD pipeline.

## Audit Logs / Forensics
*   Added structured logging for `ItemBound` events.
*   Existing `TradeManager` logs `TradeBoundItemAttempt` which now correctly triggers for `BindOnEquip` items *after* they are used.

## Status
*   **Tests:** 3/3 Passed (New), plus existing tests passing (after fixes).
*   **Validation:** Verified via `BindOnEquipHardeningTests`.
