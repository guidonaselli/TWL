# Daily Reliability Report - 2026-02-04

**Author:** Jules
**Focus:** World Loop Observability & Reliability

## Summary
Improved observability of the main `WorldScheduler` loop by introducing metrics for **Tick Drift** (lag) and **Budget Exhaustion** (skipped ticks due to overload). Fixed broken tests in the reliability suite.

## Changes
1.  **ServerMetrics**: Added `WorldLoopDriftTotalMs` and `WorldLoopBudgetExhausted` metrics.
2.  **WorldScheduler**: Instrumented the main loop to record accumulator value (drift) before processing ticks, and to record when the tick budget is exhausted (spiral of death protection).
3.  **Tests**:
    - Added `Drift_IsRecordedInMetrics` to `WorldLoopObservabilityTests`.
    - Fixed `ShutdownTests` and `WorldTriggerServiceTests` broken by constructor signature changes.
    - Deleted stale/duplicate `TWL.Tests/Services/World/WorldTriggerServiceTests.cs`.

## Evidence
Run of `WorldLoopObservabilityTests`:
```
Passed!  - Failed:     0, Passed:     3, Skipped:     0, Total:     3, Duration: 676 ms
```
The new test `Drift_IsRecordedInMetrics` confirms that induced lag is correctly captured by the metrics system.

## Metrics
- `Drift`: Measures the accumulated time debt (ms) at the start of tick processing. High average drift indicates the server is struggling to keep up with the 20 TPS target.
- `BudgetExhausted`: Counts frames where the server was so far behind it had to skip ticks to catch up (Spiral of Death protection).

## Next Steps
- Monitor `Drift` in production to establish baseline performance.
- If `BudgetExhausted` is observed, investigate `SlowTasks` correlation.
