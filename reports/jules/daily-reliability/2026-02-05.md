# Daily Reliability Report - 2026-02-05

**Agent:** Jules
**Focus:** Reliability & Observability (World Loop)

## Summary
Improved observability of the World Loop by instrumenting `WorldScheduler` and `ServerMetrics`. We can now track:
- **Drift (ms):** The difference between Wall Clock Time and Simulated Time.
- **Skipped Ticks:** The number of ticks intentionally skipped to catch up (Budget Exhausted).

## Changes
1.  **ServerMetrics**: Added `_worldLoopDriftMs` (Gauge) and `_worldLoopSkippedTicks` (Counter).
2.  **WorldScheduler**:
    - Calculated `drift = stopwatch.ElapsedMilliseconds - (CurrentTick * TickRateMs)`.
    - Recorded metrics on every loop.
    - Instrumented the "catch up" block to record skipped ticks.
3.  **Tests**: Added `Drift_Increases_Under_Load` to `TWL.Tests/Reliability/WorldLoopObservabilityTests.cs`.

## Findings / Evidence
- **Time Dilation confirmed:** Under heavy load (e.g., blocking the loop for 300ms), the scheduler caps `frameTime` at 250ms. This prevents the "catch up" logic (which requires `accumulator >= 50ms` after processing) from triggering immediately if the load is "bursty" but within the cap window per frame, or if the loop itself is stalled. However, if the loop stalls significantly, `Drift` increases because `CurrentTick` (simulated time) falls behind `Stopwatch` (real time).
- **Test Verification:**
    - `Drift_Increases_Under_Load` passed.
    - Blocking for 300ms resulted in `Drift > 0`.
    - `Skipped Ticks` logic remains in place for extreme cases where `accumulator` grows beyond `TickRateMs` even after processing `MaxTicksPerFrame`.

## Next Steps
- Monitor these metrics in production (or load test environment) to tune `MaxTicksPerFrame` or the `frameTime` cap (250ms) if "time dilation" is causing gameplay issues (desync) vs "skipping ticks" (teleporting).

## Metric Definitions
- `world_loop_drift_ms`: Gauge. High values indicate the server is running slower than real-time (Time Dilation).
- `world_loop_skipped_ticks`: Counter. increments when the server gives up on simulating time to catch up.
